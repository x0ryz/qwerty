{% extends "base.html" %}
{% load static %}

{% block title %}
    CHECKOUT
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8 font-mono">
    <h1 class="text-3xl font-black uppercase mb-8 border-b-2 border-black pb-2">
      CHECKOUT // SECURE
    </h1>

    <div class="flex flex-col lg:flex-row gap-12">

        <div class="flex-grow">
            <form method="post" class="space-y-8 order-form">
                {% csrf_token %}

                {% if form.errors %}
                <div class="bg-red-100 border-2 border-red-600 p-4 text-red-600 font-bold text-sm">
                    PLEASE CORRECT THE ERRORS BELOW.
                    {{ form.non_field_errors }}
                </div>
                {% endif %}

                <section class="border-2 border-black p-6 bg-white shadow-hard-sm">
                    <h2 class="text-xl font-bold uppercase mb-6 flex items-center border-b border-black pb-2">
                        <span class="bg-black text-white px-2 mr-2">1</span> CONTACT_INFO
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold uppercase mb-1" for="{{ form.email.id_for_label }}">Email Address</label>
                            <input type="email"
                                   name="{{ form.email.name }}"
                                   id="{{ form.email.id_for_label }}"
                                   value="{{ form.email.value|default_if_none:'' }}"
                                   class="w-full bg-gray-50 border-2 border-black p-3 focus:outline-none focus:bg-white focus:shadow-hard-sm transition-all rounded-none placeholder-gray-400"
                                   placeholder="USER@EXAMPLE.COM"
                                   required>
                            {% if form.email.errors %}
                                <div class="text-xs text-red-600 mt-1 font-bold">{{ form.email.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                </section>

                <section class="border-2 border-black p-6 bg-white shadow-hard-sm">
                    <h2 class="text-xl font-bold uppercase mb-6 flex items-center border-b border-black pb-2">
                        <span class="bg-black text-white px-2 mr-2">2</span> SHIPPING_DETAILS
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-xs font-bold uppercase mb-1" for="{{ form.first_name.id_for_label }}">First Name</label>
                            <input type="text"
                                   name="{{ form.first_name.name }}"
                                   id="{{ form.first_name.id_for_label }}"
                                   value="{{ form.first_name.value|default_if_none:'' }}"
                                   class="w-full bg-gray-50 border-2 border-black p-3 focus:outline-none focus:bg-white focus:shadow-hard-sm transition-all rounded-none"
                                   required>
                             {% if form.first_name.errors %}<div class="text-xs text-red-600 mt-1 font-bold">{{ form.first_name.errors.0 }}</div>{% endif %}
                        </div>
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-xs font-bold uppercase mb-1" for="{{ form.last_name.id_for_label }}">Last Name</label>
                            <input type="text"
                                   name="{{ form.last_name.name }}"
                                   id="{{ form.last_name.id_for_label }}"
                                   value="{{ form.last_name.value|default_if_none:'' }}"
                                   class="w-full bg-gray-50 border-2 border-black p-3 focus:outline-none focus:bg-white focus:shadow-hard-sm transition-all rounded-none"
                                   required>
                             {% if form.last_name.errors %}<div class="text-xs text-red-600 mt-1 font-bold">{{ form.last_name.errors.0 }}</div>{% endif %}
                        </div>
                        <div class="col-span-2">
                            <label class="block text-xs font-bold uppercase mb-1" for="{{ form.address.id_for_label }}">Address</label>
                            <input type="text"
                                   name="{{ form.address.name }}"
                                   id="{{ form.address.id_for_label }}"
                                   value="{{ form.address.value|default_if_none:'' }}"
                                   class="w-full bg-gray-50 border-2 border-black p-3 focus:outline-none focus:bg-white focus:shadow-hard-sm transition-all rounded-none"
                                   placeholder="STREET ADDRESS"
                                   required>
                             {% if form.address.errors %}<div class="text-xs text-red-600 mt-1 font-bold">{{ form.address.errors.0 }}</div>{% endif %}
                        </div>
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-xs font-bold uppercase mb-1" for="{{ form.city.id_for_label }}">City</label>
                            <input type="text"
                                   name="{{ form.city.name }}"
                                   id="{{ form.city.id_for_label }}"
                                   value="{{ form.city.value|default_if_none:'' }}"
                                   class="w-full bg-gray-50 border-2 border-black p-3 focus:outline-none focus:bg-white focus:shadow-hard-sm transition-all rounded-none"
                                   required>
                             {% if form.city.errors %}<div class="text-xs text-red-600 mt-1 font-bold">{{ form.city.errors.0 }}</div>{% endif %}
                        </div>
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-xs font-bold uppercase mb-1" for="{{ form.postal_code.id_for_label }}">ZIP / Postal</label>
                            <input type="text"
                                   name="{{ form.postal_code.name }}"
                                   id="{{ form.postal_code.id_for_label }}"
                                   value="{{ form.postal_code.value|default_if_none:'' }}"
                                   class="w-full bg-gray-50 border-2 border-black p-3 focus:outline-none focus:bg-white focus:shadow-hard-sm transition-all rounded-none"
                                   required>
                             {% if form.postal_code.errors %}<div class="text-xs text-red-600 mt-1 font-bold">{{ form.postal_code.errors.0 }}</div>{% endif %}
                        </div>
                    </div>
                </section>

                <button type="submit" class="w-full px-6 py-4 mt-8 font-mono font-bold text-lg uppercase transition-all active:translate-x-[2px] active:translate-y-[2px] active:shadow-none border-2 border-black focus:outline-none bg-black text-white shadow-hard hover:bg-gray-800">
                    CONFIRM ORDER // ${{ cart.get_total_price_after_discount|floatformat:2 }}
                </button>
            </form>
        </div>

        <div class="w-full lg:w-96 flex-shrink-0">
            <div class="bg-white border-2 border-black p-6 shadow-hard sticky top-24">
                <h3 class="text-lg font-bold border-b-2 border-black pb-2 mb-4">IN_YOUR_CART</h3>
                <ul class="space-y-4 mb-6">
                  {% for item in cart %}
                    {% with product=item.product %}
                    <li class="flex gap-4">
                        <div class="w-16 h-16 border-2 border-black flex-shrink-0">
                            <img src="{% if product.image %}{{ product.image.url }}{% else %}{% static "img/no_image.png" %}{% endif %}"
                                 class="w-full h-full object-cover grayscale">
                        </div>
                        <div class="flex-grow">
                            <div class="font-bold text-sm leading-tight">{{ product.name }}</div>
                            <div class="text-xs text-gray-500 mt-1">QTY: {{ item.quantity }}</div>
                            <div class="text-sm font-bold mt-1 text-right">${{ item.total_price|floatformat:2 }}</div>
                        </div>
                    </li>
                    {% endwith %}
                  {% endfor %}
                </ul>

                <div class="border-t-2 border-dashed border-black pt-4 space-y-2 text-sm">
                   <div class="flex justify-between">
                       <span>SUBTOTAL</span>
                       <span>${{ cart.get_total_price|floatformat:2 }}</span>
                   </div>

                   {% if cart.coupon %}
                   <div class="flex justify-between text-green-600 font-bold">
                       <span>COUPON ("{{ cart.coupon.code }}")</span>
                       <span>- ${{ cart.get_discount|floatformat:2 }}</span>
                   </div>
                   {% endif %}

                   <div class="flex justify-between text-gray-500 text-xs">
                       <span>SHIPPING</span>
                       <span>CALCULATED NEXT STEP</span>
                   </div>

                   <div class="flex justify-between font-bold text-lg pt-2 border-t-2 border-black mt-4">
                     <span>TOTAL</span>
                     <span>${{ cart.get_total_price_after_discount|floatformat:2 }}</span>
                   </div>
                </div>

                <div class="mt-6 text-[10px] text-gray-400 leading-tight">
                  BY CONFIRMING THIS ORDER, YOU AGREE TO OUR TERMS OF SERVICE. ALL SALES FINAL FOR BATCH #004.
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}